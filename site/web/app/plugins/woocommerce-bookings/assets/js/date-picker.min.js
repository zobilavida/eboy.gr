wc_bookings_date_picker={},jQuery(function(e){var a=0,t={init:function(){e("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),e("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),e("body").on("click",".booking_date_year, .booking_date_month, .booking_date_day",this.open_calendar),e("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),e("body").on("keypress",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_keypress),e("body").on("keypress",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_keypress),e("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),e(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),e(".wc-bookings-date-picker").each(function(){var a=e(this).closest("form"),t=a.find(".picker"),i=e(this).closest("fieldset");wc_bookings_date_picker.date_picker_init(t),"always_visible"==t.data("display")?(e(".wc-bookings-date-picker-date-fields",i).hide(),e(".wc-bookings-date-picker-choose-date",i).hide()):t.hide(),t.data("is_range_picker_enabled")&&(a.find("p.wc_bookings_field_duration").hide(),a.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==t.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(e){var a=e.closest("form"),t=e.closest("fieldset"),i=e.data("duration-unit");setTimeout(function(){var e=1,o=parseInt(t.find("input.booking_to_date_year").val(),10),n=parseInt(t.find("input.booking_to_date_month").val(),10),_=parseInt(t.find("input.booking_to_date_day").val(),10),r=parseInt(t.find("input.booking_date_year").val(),10),d=parseInt(t.find("input.booking_date_month").val(),10),s=parseInt(t.find("input.booking_date_day").val(),10);if(o&&n>=0&&_&&r&&d>=0&&s){var l=new Date(Date.UTC(r,d-1,s)),c=new Date(Date.UTC(o,n-1,_));e=Math.floor((c.getTime()-l.getTime())/864e5),"day"===i&&(e+=1)}a.find("#wc_bookings_field_duration").val(e).change()})},open_calendar:function(){$picker=e(this).closest("fieldset").find(".picker:eq(0)"),wc_bookings_date_picker.date_picker_init($picker),$picker.slideDown()},toggle_calendar:function(){$picker=e(this).closest("fieldset").find(".picker:eq(0)"),wc_bookings_date_picker.date_picker_init($picker),$picker.slideToggle()},input_date_keypress:function(){var t=e(this).closest("fieldset").find(".picker:eq(0)");t.data("is_range_picker_enabled")&&(clearTimeout(a),a=setTimeout(wc_bookings_date_picker.calc_duration(t),800))},input_date_trigger:function(){var a=e(this).closest("fieldset"),t=a.find(".picker:eq(0)"),i=(e(this).closest("form"),parseInt(a.find("input.booking_date_year").val(),10)),o=parseInt(a.find("input.booking_date_month").val(),10),n=parseInt(a.find("input.booking_date_day").val(),10);if(i&&o&&n){var _=new Date(i,o-1,n);if(t.datepicker("setDate",_),t.data("is_range_picker_enabled")){var r=parseInt(a.find("input.booking_to_date_year").val(),10),d=parseInt(a.find("input.booking_to_date_month").val(),10),s=parseInt(a.find("input.booking_to_date_day").val(),10),l=new Date(r,d-1,s);!l||l<_?(a.find("input.booking_to_date_year").val("").addClass("error"),a.find("input.booking_to_date_month").val("").addClass("error"),a.find("input.booking_to_date_day").val("").addClass("error")):a.find("input").removeClass("error")}a.triggerHandler("date-selected",_)}},select_date_trigger:function(a){var t=e(this).closest("fieldset"),i=t.find(".picker:eq(0)"),o=e(this).closest("form"),n=a.split("-"),_=i.data("start_or_end_date");i.data("is_range_picker_enabled")&&_||(_="start"),"end"===_?(i.data("min_date",i.data("o_min_date")),t.find("input.booking_to_date_year").val(n[0]),t.find("input.booking_to_date_month").val(n[1]),t.find("input.booking_to_date_day").val(n[2]).change(),i.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(i),i.data("start_or_end_date","start"),i.data("is_range_picker_enabled")&&o.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==i.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_clear_date_selection),"always_visible"!==i.data("display")&&e(this).hide()):(i.data("is_range_picker_enabled")&&(i.data("o_min_date",i.data("min_date")),i.data("min_date",a)),t.find("input.booking_to_date_year").val(""),t.find("input.booking_to_date_month").val(""),t.find("input.booking_to_date_day").val(""),t.find("input.booking_date_year").val(n[0]),t.find("input.booking_date_month").val(n[1]),t.find("input.booking_date_day").val(n[2]).change(),i.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(i),i.data("start_or_end_date","end"),i.data("is_range_picker_enabled")&&o.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===i.data("display")||i.data("is_range_picker_enabled")||e(this).hide()),t.triggerHandler("date-selected",a,_)},date_picker_init:function(a){var t;(t=e(a).is(".picker")?e(a):e(this).closest("form").find(".picker")).empty().removeClass("hasDatepicker").datepicker({dateFormat:e.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:wc_bookings_date_picker.is_bookable,onSelect:wc_bookings_date_picker.select_date_trigger,minDate:t.data("min_date"),maxDate:t.data("max_date"),defaultDate:t.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,prevText:wc_bookings_booking_form.prevText,nextText:wc_bookings_booking_form.nextText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNames:wc_bookings_booking_form.dayNames,dayNamesShort:wc_bookings_booking_form.dayNamesShort,dayNamesMin:wc_bookings_booking_form.dayNamesMin,firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0,isRTL:wc_bookings_booking_form.isRTL}),e(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var i=t.closest("form"),o=parseInt(i.find("input.booking_date_year").val(),10),n=parseInt(i.find("input.booking_date_month").val(),10),_=parseInt(i.find("input.booking_date_day").val(),10);if(o&&n&&_){var r=new Date(o,n-1,_);t.datepicker("setDate",r)}},get_input_date:function(e,a){var t=e.find("input.booking_"+a+"date_year"),i=e.find("input.booking_"+a+"date_month"),o=e.find("input.booking_"+a+"date_day");return 0!==t.val().length&&0!==i.val().length&&0!==o.val().length?t.val()+"-"+i.val()+"-"+o.val():""},is_bookable:function(a){var t=e(this).closest("form"),i=t.find(".picker:eq(0)"),o=e(this).data("availability"),n=e(this).data("default-availability"),_=e(this).data("fully-booked-days"),r=e(this).data("buffer-days"),d=e(this).data("partially-booked-days"),s=e(this).data("restricted-days"),l=e(this).data("unavailable-days"),c=(wc_bookings_booking_form.check_availability_against,""),k="",b=0,g=wc_bookings_booking_form.resources_assignment;t.find("select#wc_bookings_field_resource").val()>0&&(b=t.find("select#wc_bookings_field_resource").val());var f=wc_bookings_booking_form.booking_duration,p=new Date(a),u=p.getFullYear(),m=p.getMonth()+1,y=p.getDate(),v=p.getDay(),h=u+"-"+m+"-"+y;if(_[h]){if(_[h][0]||_[h][b])return[!1,"fully_booked",booking_form_params.i18n_date_fully_booked];"automatic"===g&&(c+="partial_booked ")}if(l&&l[h]&&l[h][b])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(r&&r[h])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(s&&void 0===s[v])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(""+u+m+y<wc_bookings_booking_form.current_time)return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];d&&d[h]&&("automatic"===g||d[h][0]||d[h][b])&&(c+="partial_booked ");var w={start_date:a,number_of_days:wc_bookings_date_picker.get_number_of_days(f,t,i,wc_bookings_booking_form),fully_booked_days:_,availability:o,default_availability:n,resource_id:b,resources_assignment:g},D=wc_bookings_date_picker.is_blocks_bookable(w);if(D){if(k=c.indexOf("partial_booked")>-1?booking_form_params.i18n_date_partially_booked:booking_form_params.i18n_date_available,i.data("is_range_picker_enabled")){var I=e(this).closest("fieldset"),T=e.datepicker.parseDate(e.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(I,"")),x=e.datepicker.parseDate(e.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(I,"to_"));return T&&(a.getTime()===T.getTime()||x&&a>=T&&a<=x)?(c+="bookable-range ",a.getTime()===T.getTime()?c+="selection-start-date ":a.getTime()===x.getTime()&&(c+="selection-end-date ")):c+="bookable",[D,c,k]}return[D,c+"bookable",k]}return[D,_[h]?"fully_booked":"not_bookable",booking_form_params.i18n_date_unavailable]},get_number_of_days:function(e,a,t,i){var o=e,n=i;return a.find("#wc_bookings_field_duration").length>0&&"minute"!=n.duration_unit&&"hour"!=n.duration_unit&&!t.data("is_range_picker_enabled")&&(o*=a.find("#wc_bookings_field_duration").val()),(o<1||"start"===n.check_availability_against)&&(o=1),o},is_blocks_bookable:function(a){for(var t=a.default_availability,i=0;i<a.number_of_days;i++){var o=new Date(a.start_date);o.setDate(o.getDate()+i);var n=o.getFullYear(),_=o.getMonth()+1,r=o.getDate(),d=o.getDay();e.datepicker.iso8601Week(o);0===d&&(d=7);var s={date:o,default_availability:a.default_availability},l=a.availability[a.resource_id];if(t=wc_bookings_date_picker.is_resource_available_on_date(s,l),"automatic"===a.resources_assignment){var c=e.extend({availability:a.availability,fully_booked_days:a.fully_booked_days},s);t=wc_bookings_date_picker.has_available_resource(c)}var k=n+"-"+_+"-"+r;if(a.fully_booked_days[k]&&(a.fully_booked_days[k][0]||a.fully_booked_days[k][a.resource_id])&&(t=!1),!t)break}return t},is_resource_available_on_date:function(a,t){if("object"!=typeof a||"object"!=typeof t)return!1;var i=a.default_availability,o=a.date.getFullYear(),n=a.date.getMonth()+1,r=a.date.getDate(),d=a.date.getDay(),s=new Date(o,0,1),l=Math.ceil(((a.date-s)/864e5+s.getDay()+1)/7);if(0===d&&(d=7),a.fully_booked_days&&a.fully_booked_days[o+"-"+n+"-"+r]&&a.fully_booked_days[o+"-"+n+"-"+r][a.resource_id])return!1;var c=[],k=_.range(1,1440,1);return i&&(c=k),e.each(t,function(e,a){var t=a.type,i=a.range;try{switch(t){case"months":if(void 0!==i[n])return c=i[n]?k:[],!0;break;case"weeks":if(void 0!==i[l])return c=i[l]?k:[],!0;break;case"days":if(void 0!==i[d])return c=i[d]?k:[],!0;break;case"custom":if(void 0!==i[o][n][r])return c=i[o][n][r]?k:[],!0;break;case"time":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":case"time:7":if(d===i.day||0===i.day){var s=parseInt(i.from.split(":")[0]),b=parseInt(i.from.split(":")[1]),g=parseInt(i.to.split(":")[0]),f=b+60*s,p=(m=parseInt(i.to.split(":")[1]))+60*g,u=_.range(f,p,1);return c=i.rule?_.union(c,u):_.difference(c,u),!0}break;case"time:range":i=i[o][n][r];var s=parseInt(i.from.split(":")[0]),b=parseInt(i.from.split(":")[1]),g=parseInt(i.to.split(":")[0]),m=parseInt(i.to.split(":")[1]),f=b+60*s,p=m+60*g,u=_.range(f,p,1);c=i.rule?_.union(c,u):_.difference(c,u)}}catch(e){return!0}}),!_.isEmpty(c)},get_week_number:function(e){var a=new Date(e.getFullYear(),0,1);return Math.ceil(((e-a)/864e5+a.getDay()+1)/7)},has_available_resource:function(e){for(var a in e.availability)if(0!==(a=parseInt(a,10))){var t=e.availability[a];if(e.resource_id=a,wc_bookings_date_picker.is_resource_available_on_date(e,t))return!0}return!1}};wc_bookings_date_picker=t,wc_bookings_date_picker.init()});
