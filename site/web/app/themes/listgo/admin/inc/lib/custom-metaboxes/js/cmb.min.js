window.CMB=function(a,b,c,d){"use strict";function k(a){return"object"==typeof a?a:(a=a.replace(/\\/g,""),a=c.parseJSON(a))}var e=a.cmb_l10,f=a.setTimeout,g={formfield:"",idNumber:!1,file_frames:{},repeatEls:'input:not([type="button"]),select,textarea,.cmb_media_status'};g.metabox=function(){return g.$metabox?g.$metabox:(g.$metabox=c("table.cmb_metabox"),g.$metabox)},g.init=function(){var b=g.metabox(),d=b.find(".repeatable-group");e.new_admin_style&&b.find(".cmb-spinner img").hide(),g.initPickers(b.find("input:text.cmb_timepicker"),b.find("input:text.cmb_datepicker"),b.find("input:text.cmb_colorpicker")),c("#ui-datepicker-div").wrap('<div class="cmb_element" />'),c('<p><span class="button cmb-multicheck-toggle">'+e.check_toggle+"</span></p>").insertBefore("ul.cmb_checkbox_list"),b.on("change",".cmb_upload_file",function(){g.formfield=c(this).attr("id"),c("#"+g.formfield+"_id").val("")}).on("click",".cmb-multicheck-toggle",g.toggleCheckBoxes).on("click",".cmb_upload_button",g.handleMedia).on("click",".cmb_remove_file_button",g.handleRemoveMedia).on("click",".add-group-row",g.addGroupRow).on("click",".add-row-button",g.addAjaxRow).on("click",".remove-group-row",g.removeGroupRow).on("click",".remove-row-button",g.removeAjaxRow).on("keyup paste focusout",".cmb_oembed",g.maybeOembed).on("cmb_remove_row",".repeatable-group",g.resetTitlesAndIterator).on("click",".visual_select label",g.visualSelection),d.length&&d.filter(".sortable").each(function(){c(this).find(".remove-group-row").before('<a class="shift-rows move-up alignleft" href="#">'+e.up_arrow+'</a> <a class="shift-rows move-down alignleft" href="#">'+e.down_arrow+"</a>")}).on("click",".shift-rows",g.shiftRows).on("cmb_add_row",g.emptyValue),f(g.resizeoEmbeds,500),c(a).on("resize",g.resizeoEmbeds)},g.resetTitlesAndIterator=function(){c(".repeatable-group").each(function(){var a=c(this);a.find(".repeatable-grouping").each(function(b){var d=c(this);d.data("iterator",b),d.find(".cmb-group-title h4").text(a.find(".add-group-row").data("grouptitle").replace("{#}",b+1))})})},g.visualSelection=function(a){a.preventDefault();var b=c(this);b.parent().children().removeClass("checked"),b.parent().find("input:checked").prop("checked",!1),b.find("input").attr("checked",!0),b.addClass("checked")},g.toggleCheckBoxes=function(a){a.preventDefault();var b=c(this),d=b.closest("td").find("input[type=checkbox]");b.data("checked")?(d.prop("checked",!1),b.data("checked",!1)):(d.prop("checked",!0),b.data("checked",!0))},g.handleMedia=function(a){if(wp){a.preventDefault();var b=g.metabox(),d=c(this);g.formfield=d.prev("input").attr("id");var f=c("#"+g.formfield),h=f.attr("name"),i=!0,j=!0,k=d.hasClass("cmb_upload_list");if(g.formfield in g.file_frames)return void g.file_frames[g.formfield].open();g.file_frames[g.formfield]=wp.media.frames.file_frame=wp.media({title:b.find("label[for="+g.formfield+"]").text(),button:{text:e.upload_file},multiple:!!k});var l={list:function(a){j=a.toJSON(),f.val(j.url),c("#"+g.formfield+"_id").val(j.id);var b=[];c(j).each(function(){i=this.type&&"image"===this.type?'<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'"><p><a href="#" class="cmb_remove_file_button" rel="'+g.formfield+"["+this.id+']">'+e.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" name="'+h+"["+this.id+']" value="'+this.url+'"></li>':"<li>"+e.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+e.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+g.formfield+"["+this.id+']">'+e.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" name="'+h+"["+this.id+']" value="'+this.url+'"></li>',b.push(i)}),c(b).each(function(){f.siblings(".cmb_media_status").slideDown().append(this)})},single:function(a){j=a.first().toJSON(),f.val(j.url).change(),c("#"+g.formfield+"_id").val(j.id),i=j.type&&"image"===j.type?'<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+j.url+'" alt="'+j.filename+'" title="'+j.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+g.formfield+'">'+e.remove_image+"</a></p></div>":e.file+" <strong>"+j.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+j.url+'" target="_blank" rel="external">'+e.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+g.formfield+'">'+e.remove_file+"</a>)",f.siblings(".cmb_media_status").slideDown().html(i)}};g.file_frames[g.formfield].on("select",function(){var a=g.file_frames[g.formfield].state().get("selection");l[k?"list":"single"](a)}),g.file_frames[g.formfield].open()}},g.handleRemoveMedia=function(a){a.preventDefault();var b=c(this);if(b.is(".attach_list .cmb_remove_file_button"))return b.parents("li").remove(),!1;g.formfield=b.attr("rel");var d=b.parents(".img_status");return g.metabox().find("input#"+g.formfield).val("").trigger("change"),g.metabox().find("input#"+g.formfield+"_id").val("").trigger("change"),d.length?d.html(""):b.parents(".cmb_media_status").html(""),!1},c.fn.replaceText=function(a,b,d){return this.each(function(){var f,g,e=this.firstChild,h=[];if(e)do{3===e.nodeType&&(f=e.nodeValue,(g=f.replace(a,b))!==f&&(!d&&/</.test(g)?(c(e).before(g),h.push(e)):e.nodeValue=g))}while(e=e.nextSibling);h.length&&c(h).remove()})},c.fn.cleanRow=function(a,b){var d=c(this),e=d.find('input:not([type="button"]), select, textarea, label');return b&&d.find(".cmb-repeat-table .repeat-row:not(:first-child)").remove(),g.$focus=!1,g.neweditor_id=[],e.filter(":checked").removeAttr("checked"),e.filter(":selected").removeAttr("selected"),d.find(".cmb-group-title")&&d.find(".cmb-group-title h4").text(d.data("title").replace("{#}",g.idNumber+1)),e.each(function(){var h,i,b=c(this),d=b.hasClass("wp-editor-area"),e=b.attr("for"),f={};if(e)f={for:e.replace("_"+a,"_"+g.idNumber)};else{var j=b.attr("name"),k=j?j.replace("["+a+"]","["+g.idNumber+"]"):"";i=b.attr("id"),h=i?i.replace("_"+a,"_"+g.idNumber):"",f={id:h,name:k,"data-iterator":g.idNumber}}if(b.removeClass("hasDatepicker").attr(f).val(""),d){h=h?i.replace("zx"+a,"zx"+g.idNumber):"",b.html("");var l=b.parents(".cmb-type-wysiwyg");l.find(".mce-tinymce:not(:first-child)").remove();var m=l.html().replace(new RegExp(i,"g"),h);l.html(m),g.neweditor_id.push({id:h,old:i})}g.$focus=g.$focus?g.$focus:b}),this},c.fn.newRowHousekeeping=function(){var a=c(this),b=a.find(".wp-picker-container"),d=a.find(".cmb_media_status");return b.length&&b.each(function(){var a=c(this).parent();a.html(a.find("input:text.cmb_colorpicker").attr("style",""))}),d.length&&d.empty(),this},g.afterRowInsert=function(a){g.$focus&&g.$focus.focus();var b;if(g.neweditor_id.length){var c;for(c=g.neweditor_id.length-1;c>=0;c--){var d=g.neweditor_id[c].id,e=g.neweditor_id[c].old;if(void 0===tinyMCEPreInit.mceInit[d]){var f=jQuery.extend({},tinyMCEPreInit.mceInit[e]);for(b in f)"string"==typeof f[b]&&(f[b]=f[b].replace(new RegExp(e,"g"),d));tinyMCEPreInit.mceInit[d]=f}if(void 0===tinyMCEPreInit.qtInit[d]){var h=jQuery.extend({},tinyMCEPreInit.qtInit[e]);for(b in h)"string"==typeof h[b]&&(h[b]=h[b].replace(new RegExp(e,"g"),d));tinyMCEPreInit.qtInit[d]=h}tinyMCE.init({id:tinyMCEPreInit.mceInit[d]})}}g.initPickers(a.find("input:text.cmb_timepicker"),a.find("input:text.cmb_datepicker"),a.find("input:text.cmb_colorpicker"))},g.updateNameAttr=function(){var a=c(this),b=a.attr("name");if(void 0===b)return!1;var d=parseInt(a.parents(".repeatable-grouping").data("iterator")),e=d-1,f=b.replace("["+d+"]","["+e+"]");a.attr("name",f)},g.emptyValue=function(a,b){c('input:not([type="button"]), textarea',b).val("")},g.addGroupRow=function(a){a.preventDefault();var b=c(this),d=c("#"+b.data("selector")),e=d.find(".repeatable-grouping").last(),f=parseInt(e.data("iterator"));g.idNumber=f+1;var h=e.clone();h.data("title",b.data("grouptitle")).newRowHousekeeping().cleanRow(f,!0);var i=c('<tr class="repeatable-grouping" data-iterator="'+g.idNumber+'">'+h.html()+"</tr>");e.after(i),g.afterRowInsert(i),d.find(".repeatable-grouping").length<=1?d.find(".remove-group-row").prop("disabled",!0):d.find(".remove-group-row").removeAttr("disabled"),d.trigger("cmb_add_row",i)},g.addAjaxRow=function(a){a.preventDefault();var b=c(this),d="#"+b.data("selector"),e=c(d),f=e.find(".empty-row"),h=parseInt(f.find("[data-iterator]").data("iterator"));g.idNumber=h+1;var i=f.clone();i.newRowHousekeeping().cleanRow(h),f.removeClass("empty-row").addClass("repeat-row"),f.after(i),g.afterRowInsert(i),e.trigger("cmb_add_row",i)},g.removeGroupRow=function(a){a.preventDefault();var b=c(this),d=c("#"+b.data("selector")),e=b.parents(".repeatable-grouping"),f=d.find(".repeatable-grouping").length;e.nextAll(".repeatable-grouping").find(g.repeatEls).each(g.updateNameAttr),f>1&&(e.remove(),f<3?d.find(".remove-group-row").prop("disabled",!0):d.find(".remove-group-row").prop("disabled",!1),d.trigger("cmb_remove_row"))},g.removeAjaxRow=function(a){a.preventDefault();var b=c(this),d=b.parents("tr"),e=b.parents(".cmb-repeat-table");e.find("tr").length>1&&(d.hasClass("empty-row")&&d.prev().addClass("empty-row").removeClass("repeat-row"),b.parents(".cmb-repeat-table tr").remove(),e.trigger("cmb_remove_row"))},g.shiftRows=function(a){a.preventDefault();var b=c(this),d=b.parents(".repeatable-grouping"),e=b.hasClass("move-up")?d.prev(".repeatable-grouping"):d.next(".repeatable-grouping");if(e.length){var f=[];d.find(g.repeatEls).each(function(){var b,a=c(this);a.hasClass("cmb_media_status")?b=a.html():"checkbox"===a.attr("type")?(b=a.is(":checked"),g.log("checked",b)):"select"===a.prop("tagName")?(b=a.is(":selected"),g.log("checked",b)):b=a.val(),f.push({val:b,$:a})}),e.find(g.repeatEls).each(function(a){var d,b=c(this);b.hasClass("cmb_media_status")?(d=b.html(),b.html(f[a].val),f[a].$.html(d)):"checkbox"===b.attr("type")?(f[a].$.prop("checked",b.is(":checked")),b.prop("checked",f[a].val)):"select"===b.prop("tagName")?(f[a].$.prop("selected",b.is(":selected")),b.prop("selected",f[a].val)):(f[a].$.val(b.val()),b.val(f[a].val))})}},g.initPickers=function(a,b,c){g.initTimePickers(a),g.initDatePickers(b),g.initColorPickers(c)},g.initTimePickers=function(a){a.length&&a.timePicker({startTime:"00:00",endTime:"23:59",show24Hours:!1,separator:":",step:30})},g.initDatePickers=function(a){a.length&&(a.datepicker("destroy"),""!==a.data("date_format")?a.datepicker({dateFormat:a.data("date_format")}):a.datepicker())},g.initColorPickers=function(a){if(a.length)if("object"==typeof wilokeAdmin||"object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker){var b=!1;null!==WilokeAdminGlobal.ColorPalatte&&(b=!0,WilokeAdminGlobal.ColorPalatte=c.parseJSON(WilokeAdminGlobal.ColorPalatte)),a.spectrum({preferredFormat:"rgb",showAlpha:!0,change:function(a){null!==a&&(c(this).attr("value",a.toRgbString()),c(this).data({color:a.toRgbString(),rgbcolor:a.toHexString()}))},move:function(a){null!==a?c(this).data({color:a.toRgbString(),rgbcolor:a.toHexString()}).change():c(this).data({color:"",rgbcolor:""}).change()},hide:function(a){null!==a?c(this).data({color:a.toRgbString(),rgbcolor:a.toHexString()}).change():c(this).data({color:"",rgbcolor:""}).change(),c(this).closest(".cmb-type-colorpicker").trigger("spectrum-hide")},show:function(a){null!==a&&c(this).data({color:a.toRgbString(),rgbcolor:a.toHexString()}),c(this).closest(".cmb-type-colorpicker").trigger("spectrum-show"),c(this).trigger("spectrum-show")},allowEmpty:!0,showInput:!0,showPalette:b,palette:WilokeAdminGlobal.ColorPalatte})}else a.each(function(a){c(this).after('<div id="picker-'+a+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),c("#picker-"+a).hide().farbtastic(c(this))}).focus(function(){c(this).next().show()}).blur(function(){c(this).next().hide()})},g.maybeOembed=function(a){var b=c(this),d=a.type;({focusout:function(){f(function(){g.spinner(".postbox table.cmb_metabox",!0)},2e3)},keyup:function(){var c=function(b,c){return a.which<=c&&a.which>=b};(c(48,90)||c(96,111)||c(8,9)||187===a.which||190===a.which)&&g.doAjax(b,a)},paste:function(){f(function(){g.doAjax(b)},100)}})[d]()},g.resizeoEmbeds=function(){g.metabox().each(function(){var a=c(this),b=a.parents(".inside");if(!b.length)return!0;var d=Math.round(.82*b.width()*.97)-30;if(d>639)return!0;var e=a.find(".cmb-type-oembed .embed_status"),f=e.children().not(".cmb_remove_wrapper");if(!f.length)return!0;f.each(function(){var a=c(this),b=a.width(),e=a.height(),f=d;a.parents(".repeat-row").length&&(f=d-91);var g=Math.round(f*e/b);a.width(f).height(g)})})},g.log=function(){e.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},g.spinner=function(a,b){b?c(".cmb-spinner",a).hide():c(".cmb-spinner",a).show()},g.doAjax=function(a){var b=a.val();if(!(b.length<6)){var d=a.attr("id"),h=a.parents(".cmb-repeat-table  tr td");h=h.length?h:a.parents(".cmb_metabox tr td");var i=c(".embed_status",h),j=a.width(),k=c(":first-child",i);g.log("oembed_url",b,d),j=i.length&&k.length?k.width():a.width(),g.spinner(h),c(".embed_wrap",h).html(""),f(function(){c(".cmb_oembed:focus").val()===b&&c.ajax({type:"post",dataType:"json",url:e.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:b,oembed_width:j>300?j:300,field_id:d,object_id:a.data("objectid"),object_type:a.data("objecttype"),cmb_ajax_nonce:e.ajax_nonce},success:function(a){g.log(a),void 0!==a.id&&(g.spinner(h,!0),c(".embed_wrap",h).html(a.result))}})},500)}},c(b).ready(g.init);var h=c(".wiloke-has-dependency"),i=c(".wiloke-has-dependency-on-template"),j=c(".wiloke-table-has-dependency-on-template");return i.length>0&&i.each(function(){var a=c(this),b="",d=a.attr("data-dependencyontemplate"),e=!1,f=c("#page_template");d=k(d),0==f.length&&"not_contains"!=d.operator?(a.addClass("wiloke-is-hidden-with-template"),a.closest("tr").hide()):f.change(function(){switch(b=c(this).val(),d.operator){case"=":e=b==d.match;break;case"contains":var f=d.match.split(",");e=-1!=f.indexOf(b);break;case"not_contains":var f=d.match.split(",");e=-1==f.indexOf(b)}e?(a.removeClass("wiloke-is-hidden-with-template"),a.closest("tr").show()):(a.addClass("wiloke-is-hidden-with-template"),a.closest("tr").hide())}).trigger("change")}),c.fn.wilokeDependency=function(){var a=c(this),b=c(this).data("dependency"),d="",e=!0,f=c(this).closest(".cmb_metabox.form-table, .wiloke__box-content").find('[name="'+b.name+'"]');f.hasClass("is_visual_selection")&&(f=f.parent()),b=k(b),f.on("click change",function(f){switch(f.preventDefault(),d=c(f.currentTarget).hasClass("js-visual-selection")?c(this).children().attr("value"):c(this).val(),b.operator){case"=":e=d==b.match;break;case"contains":var g=b.match.split(",");e=-1!=g.indexOf(d);break;case"not_contains":var g=b.match.split(",");e=-1==g.indexOf(d);break;case"not_empty":e=!!c(this).attr("checked")}e?a.hasClass("wiloke-is-hidden-with-template")||a.closest("tr, .wiloke__filter").removeClass("hidden"):a.closest("tr, .wiloke__filter").addClass("hidden")}),f.hasClass("js-visual-selection")?f.parent().find(".js-visual-selection.checked").trigger("click"):f.trigger("change")},h.length>0&&h.each(function(){c(this).wilokeDependency()}),c.fn.wilokeFormDependencyOnTemplate=function(){var a=c(this),b="",d=c(this).data("dependencyontemplate"),e=!1,f=c("#page_template");d=k(d),0==f.length&&"not_contains"!=d.operator?a.closest(".postbox").hide():f.change(function(){switch(b=c(this).val(),d.operator){case"=":e=b==d.match;break;case"contains":var f=d.match.split(",");e=-1!=f.indexOf(b);break;case"not_contains":var f=d.match.split(",");e=-1==f.indexOf(b)}e?a.closest(".postbox").show():a.closest(".postbox").hide()}).trigger("change")},j.length>0&&j.each(function(){c(this).wilokeFormDependencyOnTemplate()}),g}(window,document,jQuery);