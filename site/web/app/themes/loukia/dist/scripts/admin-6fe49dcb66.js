function upload_image_button(e){e.preventDefault();var t=$(e.currentTarget),a=t.prev(),l=t.parent().find(".uploaded_image"),r=wp.media.frames.file_frame=wp.media({title:"Add Image",button:{text:"Add Image"},multiple:!1});r.on("select",function(){var e=r.state().get("selection").first().toJSON();a.val(e.url),l.html('<img src="'+e.url+'" />')}),r.open()}function remove_image_button(e){e.preventDefault();var t=$(e.currentTarget),a=t.parent().find(".featured_image_upload"),l=t.parent().find(".uploaded_image");a.val(""),l.html("")}function upload_gallery_button(e){var t=$(e.currentTarget);if(e.preventDefault(),!t.data("lockedAt")||+new Date-t.data("lockedAt")>300){var a=$("#mytheme_gallery_input"),l=a.val(),r='[gallery ids="'+l+'"]';wp.media.gallery.edit(r).on("update",function(e){var t=[],l=[];$.each(e.models,function(e,a){l.push(a.attributes.url),t.push(a.id)});var r=t.join(",");r=r.replace(/,\s*$/,"");var n=l.join(",");n=n.replace(/,\s*$/,""),a.val(r);for(var i="",o=0;o<l.length;o++)i+='<div class="gallery-item" data-id="'+t[o]+'"><div class="remove">x</div><img src="'+l[o]+'"></div>';$(".gallery_images").html("").append(i)})}t.data("lockedAt",+new Date)}function empty_gallery_button(e){e.preventDefault(),$("#mytheme_gallery_input").val(""),$(".gallery_images").html("")}function empty_single_image(e){e.preventDefault();var t=$(this),a=t.parent().data("id"),l=t.parent().find("img"),r=(l.attr("src"),$("#mytheme_gallery_input")),n=r.val().split(","),i=n.remove(a.toString()),o=i.join();r.val("").val(o),t.parent().remove()}$(document).on("click",".upload_image_button",upload_image_button).on("click",".remove_image_button",remove_image_button),Array.prototype.remove=function(){for(var e,t,a=arguments,l=a.length;l&&this.length;)for(e=a[--l];-1!==(t=this.indexOf(e));)this.splice(t,1);return this},$(document).on("click","#manage_gallery",upload_gallery_button).on("click","#empty_gallery",empty_gallery_button).on("click",".gallery-item .remove",empty_single_image);